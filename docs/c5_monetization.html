<!DOCTYPE html>
<html lang="ru-RU" xml:lang="ru-RU">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Метрики монетизации pt.2 | Методы анализа больших данных</title>
  <meta name="description" content="Метрики монетизации pt.2 | Методы анализа больших данных" />
  <meta name="generator" content="bookdown 0.35 and GitBook 2.6.7" />

  <meta property="og:title" content="Метрики монетизации pt.2 | Методы анализа больших данных" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Метрики монетизации pt.2 | Методы анализа больших данных" />
  
  
  

<meta name="author" content="Ph.A.Upravitelev" />


<meta name="date" content="2023-10-15" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="c4_monetization.html"/>
<link rel="next" href="метрики-монетизации-pt.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/htmlwidgets-1.6.2/htmlwidgets.js"></script>
<script src="libs/plotly-binding-4.10.2/plotly.js"></script>
<script src="libs/typedarray-0.1/typedarray.min.js"></script>
<link href="libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet" />
<script src="libs/crosstalk-1.2.0/js/crosstalk.min.js"></script>
<link href="libs/plotly-htmlwidgets-css-2.11.1/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="libs/plotly-main-2.11.1/plotly-latest.min.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">mar 221f</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Intro</a></li>
<li class="chapter" data-level="" data-path="c1_intro.html"><a href="c1_intro.html"><i class="fa fa-check"></i>О курсе и аналитиках</a>
<ul>
<li class="chapter" data-level="" data-path="c1_intro.html"><a href="c1_intro.html#запись-занятия"><i class="fa fa-check"></i>Запись занятия</a></li>
<li class="chapter" data-level="" data-path="c1_intro.html"><a href="c1_intro.html#обо-мне"><i class="fa fa-check"></i>Обо мне</a></li>
<li class="chapter" data-level="" data-path="c1_intro.html"><a href="c1_intro.html#contacts"><i class="fa fa-check"></i>Contacts</a></li>
<li class="chapter" data-level="" data-path="c1_intro.html"><a href="c1_intro.html#о-курсе"><i class="fa fa-check"></i>О курсе</a>
<ul>
<li class="chapter" data-level="" data-path="c1_intro.html"><a href="c1_intro.html#темы-лекций"><i class="fa fa-check"></i>темы лекций</a></li>
<li class="chapter" data-level="" data-path="c1_intro.html"><a href="c1_intro.html#факультативно"><i class="fa fa-check"></i>факультативно</a></li>
<li class="chapter" data-level="" data-path="c1_intro.html"><a href="c1_intro.html#формы-контроля"><i class="fa fa-check"></i>формы контроля</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="c1_intro.html"><a href="c1_intro.html#виды-аналитиков"><i class="fa fa-check"></i>Виды аналитиков</a>
<ul>
<li class="chapter" data-level="" data-path="c1_intro.html"><a href="c1_intro.html#data-scientists"><i class="fa fa-check"></i>data scientists</a></li>
<li class="chapter" data-level="" data-path="c1_intro.html"><a href="c1_intro.html#web-аналитика"><i class="fa fa-check"></i>web-аналитика</a></li>
<li class="chapter" data-level="" data-path="c1_intro.html"><a href="c1_intro.html#маркетинговая-аналитика"><i class="fa fa-check"></i>маркетинговая аналитика</a></li>
<li><a href="c1_intro.html#section" id="toc-section"></a></li>
</ul></li>
<li class="chapter" data-level="" data-path="c1_intro.html"><a href="c1_intro.html#продуктовая-аналитика"><i class="fa fa-check"></i>Продуктовая аналитика</a>
<ul>
<li class="chapter" data-level="" data-path="c1_intro.html"><a href="c1_intro.html#что-такое-продукт"><i class="fa fa-check"></i>что такое продукт</a></li>
<li class="chapter" data-level="" data-path="c1_intro.html"><a href="c1_intro.html#cxux-исследователи"><i class="fa fa-check"></i>CX/UX-исследователи</a></li>
<li class="chapter" data-level="" data-path="c1_intro.html"><a href="c1_intro.html#структура-команды-разработки"><i class="fa fa-check"></i>структура команды разработки</a></li>
<li class="chapter" data-level="" data-path="c1_intro.html"><a href="c1_intro.html#роли-продуктовых-аналитиков"><i class="fa fa-check"></i>роли продуктовых аналитиков</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="c1_intro.html"><a href="c1_intro.html#стадии-развития-продукта"><i class="fa fa-check"></i>Стадии развития продукта</a>
<ul>
<li class="chapter" data-level="" data-path="c1_intro.html"><a href="c1_intro.html#этапы-жизни"><i class="fa fa-check"></i>этапы жизни</a></li>
<li class="chapter" data-level="" data-path="c1_intro.html"><a href="c1_intro.html#технические-этапы"><i class="fa fa-check"></i>технические этапы</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="c1_intro.html"><a href="c1_intro.html#бизнес-модели"><i class="fa fa-check"></i>Бизнес-модели</a>
<ul>
<li class="chapter" data-level="" data-path="c1_intro.html"><a href="c1_intro.html#компоненты"><i class="fa fa-check"></i>компоненты</a></li>
<li class="chapter" data-level="" data-path="c1_intro.html"><a href="c1_intro.html#варианты"><i class="fa fa-check"></i>варианты</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="c1_intro.html"><a href="c1_intro.html#полезные-материалы"><i class="fa fa-check"></i>Полезные материалы</a></li>
<li class="chapter" data-level="" data-path="c1_intro.html"><a href="c1_intro.html#домашнее-задание"><i class="fa fa-check"></i>Домашнее задание</a>
<ul>
<li class="chapter" data-level="" data-path="c1_intro.html"><a href="c1_intro.html#для-тех-кто-не-был-на-прошлом-курсе"><i class="fa fa-check"></i>Для тех, кто не был на прошлом курсе</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="метрики-вовлечения-pt1.html"><a href="метрики-вовлечения-pt1.html"><i class="fa fa-check"></i>Метрики вовлечения pt1</a>
<ul>
<li class="chapter" data-level="" data-path="метрики-вовлечения-pt1.html"><a href="метрики-вовлечения-pt1.html#запись-занятия-1"><i class="fa fa-check"></i>Запись занятия</a></li>
<li class="chapter" data-level="" data-path="метрики-вовлечения-pt1.html"><a href="метрики-вовлечения-pt1.html#aarrr-фреймворк"><i class="fa fa-check"></i>AARRR фреймворк</a></li>
<li class="chapter" data-level="" data-path="метрики-вовлечения-pt1.html"><a href="метрики-вовлечения-pt1.html#user-aquisition"><i class="fa fa-check"></i>User Aquisition</a>
<ul>
<li class="chapter" data-level="" data-path="метрики-вовлечения-pt1.html"><a href="метрики-вовлечения-pt1.html#процесс-привлечения-пользователей"><i class="fa fa-check"></i>Процесс привлечения пользователей</a></li>
<li class="chapter" data-level="" data-path="метрики-вовлечения-pt1.html"><a href="метрики-вовлечения-pt1.html#маркетинговая-воронка-в-мобильных-приложениях"><i class="fa fa-check"></i>Маркетинговая воронка в мобильных приложениях</a></li>
<li class="chapter" data-level="" data-path="метрики-вовлечения-pt1.html"><a href="метрики-вовлечения-pt1.html#новый-пользователь"><i class="fa fa-check"></i>Новый пользователь</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="метрики-вовлечения-pt1.html"><a href="метрики-вовлечения-pt1.html#активность-и-вовлечение"><i class="fa fa-check"></i>Активность и вовлечение</a>
<ul>
<li class="chapter" data-level="" data-path="метрики-вовлечения-pt1.html"><a href="метрики-вовлечения-pt1.html#dau-wau-mau"><i class="fa fa-check"></i>DAU, WAU, MAU</a></li>
<li class="chapter" data-level="" data-path="метрики-вовлечения-pt1.html"><a href="метрики-вовлечения-pt1.html#stickness-sticky-factor"><i class="fa fa-check"></i>Stickness / Sticky factor</a></li>
<li class="chapter" data-level="" data-path="метрики-вовлечения-pt1.html"><a href="метрики-вовлечения-pt1.html#retention-rate"><i class="fa fa-check"></i>Retention rate</a></li>
<li class="chapter" data-level="" data-path="метрики-вовлечения-pt1.html"><a href="метрики-вовлечения-pt1.html#churn-rate"><i class="fa fa-check"></i>Churn rate</a></li>
<li class="chapter" data-level="" data-path="метрики-вовлечения-pt1.html"><a href="метрики-вовлечения-pt1.html#sessions-per-day"><i class="fa fa-check"></i>Sessions per day</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="метрики-вовлечения-pt1.html"><a href="метрики-вовлечения-pt1.html#полезные-материалы-1"><i class="fa fa-check"></i>Полезные материалы</a></li>
<li class="chapter" data-level="" data-path="метрики-вовлечения-pt1.html"><a href="метрики-вовлечения-pt1.html#домашнее-задание-1"><i class="fa fa-check"></i>Домашнее задание</a>
<ul>
<li class="chapter" data-level="" data-path="метрики-вовлечения-pt1.html"><a href="метрики-вовлечения-pt1.html#level-1-iatytd"><i class="fa fa-check"></i>level 1 (IATYTD)</a></li>
<li class="chapter" data-level="" data-path="метрики-вовлечения-pt1.html"><a href="метрики-вовлечения-pt1.html#level-2-hntr"><i class="fa fa-check"></i>level 2 (HNTR)</a></li>
<li class="chapter" data-level="" data-path="метрики-вовлечения-pt1.html"><a href="метрики-вовлечения-pt1.html#level-3-hmp"><i class="fa fa-check"></i>level 3 (HMP)</a></li>
<li class="chapter" data-level="" data-path="метрики-вовлечения-pt1.html"><a href="метрики-вовлечения-pt1.html#level-4-uv"><i class="fa fa-check"></i>level 4 (UV)</a></li>
<li class="chapter" data-level="" data-path="метрики-вовлечения-pt1.html"><a href="метрики-вовлечения-pt1.html#level-5-n"><i class="fa fa-check"></i>level 5 (N)</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="метрики-вовлечения-pt2.html"><a href="метрики-вовлечения-pt2.html"><i class="fa fa-check"></i>Метрики вовлечения pt2</a>
<ul>
<li class="chapter" data-level="" data-path="метрики-вовлечения-pt2.html"><a href="метрики-вовлечения-pt2.html#запись-занятия-2"><i class="fa fa-check"></i>Запись занятия</a>
<ul>
<li class="chapter" data-level="" data-path="метрики-вовлечения-pt2.html"><a href="метрики-вовлечения-pt2.html#level-2-hntr-1"><i class="fa fa-check"></i>level 2 (HNTR)</a></li>
<li class="chapter" data-level="" data-path="метрики-вовлечения-pt2.html"><a href="метрики-вовлечения-pt2.html#level-4-uv-1"><i class="fa fa-check"></i>level 4 (UV)</a></li>
<li class="chapter" data-level="" data-path="метрики-вовлечения-pt2.html"><a href="метрики-вовлечения-pt2.html#level-5-n-1"><i class="fa fa-check"></i>level 5 (N)</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="метрики-вовлечения-pt2.html"><a href="метрики-вовлечения-pt2.html#расчет-retention"><i class="fa fa-check"></i>Расчет retention</a></li>
<li class="chapter" data-level="" data-path="метрики-вовлечения-pt2.html"><a href="метрики-вовлечения-pt2.html#домашнее-задание-2"><i class="fa fa-check"></i>Домашнее задание</a>
<ul>
<li class="chapter" data-level="" data-path="метрики-вовлечения-pt2.html"><a href="метрики-вовлечения-pt2.html#level-1-iatytd-1"><i class="fa fa-check"></i>level 1 (IATYTD)</a></li>
<li class="chapter" data-level="" data-path="метрики-вовлечения-pt2.html"><a href="метрики-вовлечения-pt2.html#level-2-hntr-2"><i class="fa fa-check"></i>level 2 (HNTR)</a></li>
<li class="chapter" data-level="" data-path="метрики-вовлечения-pt2.html"><a href="метрики-вовлечения-pt2.html#level-3-hmp-1"><i class="fa fa-check"></i>level 3 (HMP)</a></li>
<li class="chapter" data-level="" data-path="метрики-вовлечения-pt2.html"><a href="метрики-вовлечения-pt2.html#level-4-uv-2"><i class="fa fa-check"></i>level 4 (UV)</a></li>
<li class="chapter" data-level="" data-path="метрики-вовлечения-pt2.html"><a href="метрики-вовлечения-pt2.html#level-5-n-2"><i class="fa fa-check"></i>level 5 (N)</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="c4_monetization.html"><a href="c4_monetization.html"><i class="fa fa-check"></i>Метрики монетизации pt.1</a>
<ul>
<li class="chapter" data-level="" data-path="c4_monetization.html"><a href="c4_monetization.html#запись-занятия-3"><i class="fa fa-check"></i>Запись занятия</a></li>
<li class="chapter" data-level="" data-path="c4_monetization.html"><a href="c4_monetization.html#разбор-домашнего-задания"><i class="fa fa-check"></i>Разбор домашнего задания</a>
<ul>
<li class="chapter" data-level="" data-path="c4_monetization.html"><a href="c4_monetization.html#level-2-hntr-3"><i class="fa fa-check"></i>level 2 (HNTR)</a></li>
<li class="chapter" data-level="" data-path="c4_monetization.html"><a href="c4_monetization.html#level-3-hmp-2"><i class="fa fa-check"></i>level 3 (HMP)</a></li>
<li class="chapter" data-level="" data-path="c4_monetization.html"><a href="c4_monetization.html#level-4-uv-3"><i class="fa fa-check"></i>level 4 (UV)</a></li>
<li class="chapter" data-level="" data-path="c4_monetization.html"><a href="c4_monetization.html#level-5-n-3"><i class="fa fa-check"></i>level 5 (N)</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="c4_monetization.html"><a href="c4_monetization.html#платежные-метрики"><i class="fa fa-check"></i>Платежные метрики</a>
<ul>
<li class="chapter" data-level="" data-path="c4_monetization.html"><a href="c4_monetization.html#gross-net"><i class="fa fa-check"></i>Gross / Net</a></li>
<li class="chapter" data-level="" data-path="c4_monetization.html"><a href="c4_monetization.html#конверсия"><i class="fa fa-check"></i>Конверсия</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="c4_monetization.html"><a href="c4_monetization.html#полезные-материалы-2"><i class="fa fa-check"></i>Полезные материалы</a></li>
<li class="chapter" data-level="" data-path="c4_monetization.html"><a href="c4_monetization.html#домашнее-задание-3"><i class="fa fa-check"></i>Домашнее задание</a>
<ul>
<li class="chapter" data-level="" data-path="c4_monetization.html"><a href="c4_monetization.html#level-1-iatytd-2"><i class="fa fa-check"></i>level 1 (IATYTD)</a></li>
<li class="chapter" data-level="" data-path="c4_monetization.html"><a href="c4_monetization.html#level-2-hntr-4"><i class="fa fa-check"></i>level 2 (HNTR)</a></li>
<li class="chapter" data-level="" data-path="c4_monetization.html"><a href="c4_monetization.html#level-3-hmp-3"><i class="fa fa-check"></i>level 3 (HMP)</a></li>
<li class="chapter" data-level="" data-path="c4_monetization.html"><a href="c4_monetization.html#level-4-uv-4"><i class="fa fa-check"></i>level 4 (UV)</a></li>
<li class="chapter" data-level="" data-path="c4_monetization.html"><a href="c4_monetization.html#level-5-n-4"><i class="fa fa-check"></i>level 5 (N)</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="c5_monetization.html"><a href="c5_monetization.html"><i class="fa fa-check"></i>Метрики монетизации pt.2</a>
<ul>
<li class="chapter" data-level="" data-path="c5_monetization.html"><a href="c5_monetization.html#запись-занятия-4"><i class="fa fa-check"></i>Запись занятия</a></li>
<li class="chapter" data-level="" data-path="c5_monetization.html"><a href="c5_monetization.html#разбор-домашнего-задания-1"><i class="fa fa-check"></i>Разбор домашнего задания</a>
<ul>
<li class="chapter" data-level="" data-path="c5_monetization.html"><a href="c5_monetization.html#level-2-hntr-5"><i class="fa fa-check"></i>level 2 (HNTR)</a></li>
<li class="chapter" data-level="" data-path="c5_monetization.html"><a href="c5_monetization.html#level-3-hmp-4"><i class="fa fa-check"></i>level 3 (HMP)</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="c5_monetization.html"><a href="c5_monetization.html#воронка-платежей"><i class="fa fa-check"></i>Воронка платежей</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="метрики-монетизации-pt.html"><a href="метрики-монетизации-pt.html"><i class="fa fa-check"></i>Метрики монетизации pt.3</a>
<ul>
<li class="chapter" data-level="" data-path="метрики-монетизации-pt.html"><a href="метрики-монетизации-pt.html#запись-занятия-5"><i class="fa fa-check"></i>Запись занятия</a></li>
<li class="chapter" data-level="" data-path="метрики-монетизации-pt.html"><a href="метрики-монетизации-pt.html#arpu-arppu"><i class="fa fa-check"></i>ARPU / ARPPU</a>
<ul>
<li class="chapter" data-level="" data-path="метрики-монетизации-pt.html"><a href="метрики-монетизации-pt.html#задача-1-1"><i class="fa fa-check"></i>задача 1</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="метрики-монетизации-pt.html"><a href="метрики-монетизации-pt.html#ltv"><i class="fa fa-check"></i>LTV</a>
<ul>
<li class="chapter" data-level="" data-path="метрики-монетизации-pt.html"><a href="метрики-монетизации-pt.html#задача-2-1"><i class="fa fa-check"></i>задача 2</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="метрики-монетизации-pt.html"><a href="метрики-монетизации-pt.html#полезные-материалы-3"><i class="fa fa-check"></i>Полезные материалы</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Методы анализа больших данных</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="c5_monetization" class="section level1 hasAnchor">
<h1>Метрики монетизации pt.2<a href="c5_monetization.html#c5_monetization" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="запись-занятия-4" class="section level2 unnumbered hasAnchor">
<h2>Запись занятия<a href="c5_monetization.html#запись-занятия-4" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<iframe width="560" height="315" src="https://www.youtube.com/embed/2DjR09pvky0?si=w4Cj2J9gj436byIz" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen>
</iframe>
</div>
<div id="разбор-домашнего-задания-1" class="section level2 hasAnchor">
<h2>Разбор домашнего задания<a href="c5_monetization.html#разбор-домашнего-задания-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="level-2-hntr-5" class="section level3 hasAnchor">
<h3>level 2 (HNTR)<a href="c5_monetization.html#level-2-hntr-5" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Постройте график накопительной конверсии с разбивкой по источнику пользователей.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="c5_monetization.html#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(data.table)</span>
<span id="cb23-2"><a href="c5_monetization.html#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(plotly)</span>
<span id="cb23-3"><a href="c5_monetization.html#cb23-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-4"><a href="c5_monetization.html#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="co"># импортируем данные</span></span>
<span id="cb23-5"><a href="c5_monetization.html#cb23-5" aria-hidden="true" tabindex="-1"></a>installs <span class="ot">&lt;-</span> <span class="fu">fread</span>(<span class="st">&#39;https://gitlab.com/hse_mar/mar211f/-/raw/main/data/installs.csv&#39;</span>) </span>
<span id="cb23-6"><a href="c5_monetization.html#cb23-6" aria-hidden="true" tabindex="-1"></a>payments <span class="ot">&lt;-</span> <span class="fu">fread</span>(<span class="st">&#39;https://gitlab.com/hse_mar/mar211f/-/raw/main/data/payments_custom.csv&#39;</span>)</span>
<span id="cb23-7"><a href="c5_monetization.html#cb23-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-8"><a href="c5_monetization.html#cb23-8" aria-hidden="true" tabindex="-1"></a><span class="co"># перекодируем медиасорсы</span></span>
<span id="cb23-9"><a href="c5_monetization.html#cb23-9" aria-hidden="true" tabindex="-1"></a>installs[<span class="fu">is.na</span>(media_source), media_source <span class="sc">:</span><span class="er">=</span> <span class="st">&#39;organic&#39;</span>]</span>
<span id="cb23-10"><a href="c5_monetization.html#cb23-10" aria-hidden="true" tabindex="-1"></a>installs[media_source <span class="sc">==</span> <span class="st">&#39;other&#39;</span>, media_source <span class="sc">:</span><span class="er">=</span> <span class="st">&#39;organic&#39;</span>]</span>
<span id="cb23-11"><a href="c5_monetization.html#cb23-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-12"><a href="c5_monetization.html#cb23-12" aria-hidden="true" tabindex="-1"></a><span class="co"># выбираем первый инсталл</span></span>
<span id="cb23-13"><a href="c5_monetization.html#cb23-13" aria-hidden="true" tabindex="-1"></a>installs <span class="ot">&lt;-</span> installs[<span class="fu">order</span>(user_pseudo_id, dt)]</span>
<span id="cb23-14"><a href="c5_monetization.html#cb23-14" aria-hidden="true" tabindex="-1"></a>installs <span class="ot">&lt;-</span> installs[, .SD[<span class="dv">1</span>], by <span class="ot">=</span> user_pseudo_id]</span>
<span id="cb23-15"><a href="c5_monetization.html#cb23-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-16"><a href="c5_monetization.html#cb23-16" aria-hidden="true" tabindex="-1"></a><span class="co"># берем платежи только новых пользователей</span></span>
<span id="cb23-17"><a href="c5_monetization.html#cb23-17" aria-hidden="true" tabindex="-1"></a>payments_new <span class="ot">&lt;-</span> payments[user_pseudo_id <span class="sc">%in%</span> installs[, <span class="fu">unique</span>(user_pseudo_id)]]</span>
<span id="cb23-18"><a href="c5_monetization.html#cb23-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-19"><a href="c5_monetization.html#cb23-19" aria-hidden="true" tabindex="-1"></a><span class="co"># прикрепляем к ним медиасорсы</span></span>
<span id="cb23-20"><a href="c5_monetization.html#cb23-20" aria-hidden="true" tabindex="-1"></a>payments_new <span class="ot">&lt;-</span> <span class="fu">merge</span>(</span>
<span id="cb23-21"><a href="c5_monetization.html#cb23-21" aria-hidden="true" tabindex="-1"></a>  payments_new,</span>
<span id="cb23-22"><a href="c5_monetization.html#cb23-22" aria-hidden="true" tabindex="-1"></a>  installs[, <span class="fu">list</span>(user_pseudo_id, dt, media_source)],</span>
<span id="cb23-23"><a href="c5_monetization.html#cb23-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">by =</span> <span class="st">&#39;user_pseudo_id&#39;</span>, <span class="at">all.x =</span> <span class="cn">TRUE</span></span>
<span id="cb23-24"><a href="c5_monetization.html#cb23-24" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb23-25"><a href="c5_monetization.html#cb23-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-26"><a href="c5_monetization.html#cb23-26" aria-hidden="true" tabindex="-1"></a><span class="co"># payments_new &lt;- merge(</span></span>
<span id="cb23-27"><a href="c5_monetization.html#cb23-27" aria-hidden="true" tabindex="-1"></a><span class="co">#   payments_new,</span></span>
<span id="cb23-28"><a href="c5_monetization.html#cb23-28" aria-hidden="true" tabindex="-1"></a><span class="co">#   installs[, list(user_pseudo_id, dt, media_source)],</span></span>
<span id="cb23-29"><a href="c5_monetization.html#cb23-29" aria-hidden="true" tabindex="-1"></a><span class="co">#   by = &#39;user_pseudo_id&#39;, all = FALSE</span></span>
<span id="cb23-30"><a href="c5_monetization.html#cb23-30" aria-hidden="true" tabindex="-1"></a><span class="co"># )</span></span>
<span id="cb23-31"><a href="c5_monetization.html#cb23-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-32"><a href="c5_monetization.html#cb23-32" aria-hidden="true" tabindex="-1"></a><span class="co"># вычисляем лайфтайм</span></span>
<span id="cb23-33"><a href="c5_monetization.html#cb23-33" aria-hidden="true" tabindex="-1"></a>payments_new[, lifetime <span class="sc">:</span><span class="er">=</span> pay_dt <span class="sc">-</span> dt]</span>
<span id="cb23-34"><a href="c5_monetization.html#cb23-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-35"><a href="c5_monetization.html#cb23-35" aria-hidden="true" tabindex="-1"></a><span class="co"># корректируем на окно лайфтайма</span></span>
<span id="cb23-36"><a href="c5_monetization.html#cb23-36" aria-hidden="true" tabindex="-1"></a><span class="co"># as.Date(&#39;2022-07-31&#39;) - as.Date(&#39;2022-06-30&#39;)</span></span>
<span id="cb23-37"><a href="c5_monetization.html#cb23-37" aria-hidden="true" tabindex="-1"></a>payments_new <span class="ot">&lt;-</span> payments_new[dt <span class="sc">&lt;</span> <span class="st">&#39;2022-07-01&#39;</span>]</span>
<span id="cb23-38"><a href="c5_monetization.html#cb23-38" aria-hidden="true" tabindex="-1"></a>payments_new <span class="ot">&lt;-</span> payments_new[lifetime <span class="sc">&lt;=</span> <span class="dv">30</span>]</span>
<span id="cb23-39"><a href="c5_monetization.html#cb23-39" aria-hidden="true" tabindex="-1"></a>payments_new <span class="ot">&lt;-</span> payments_new[lifetime <span class="sc">&gt;=</span> <span class="dv">0</span>]</span>
<span id="cb23-40"><a href="c5_monetization.html#cb23-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-41"><a href="c5_monetization.html#cb23-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-42"><a href="c5_monetization.html#cb23-42" aria-hidden="true" tabindex="-1"></a><span class="co"># считаем, когда пользователь сделал первый платеж (минимальный лайфтайм)</span></span>
<span id="cb23-43"><a href="c5_monetization.html#cb23-43" aria-hidden="true" tabindex="-1"></a>payments_new_stat <span class="ot">&lt;-</span> payments_new[, <span class="fu">list</span>(<span class="at">lifetime =</span> <span class="fu">min</span>(lifetime)), </span>
<span id="cb23-44"><a href="c5_monetization.html#cb23-44" aria-hidden="true" tabindex="-1"></a>                                  by <span class="ot">=</span> <span class="fu">list</span>(user_pseudo_id, media_source)]</span>
<span id="cb23-45"><a href="c5_monetization.html#cb23-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-46"><a href="c5_monetization.html#cb23-46" aria-hidden="true" tabindex="-1"></a><span class="co"># считаем распределение пользователей по этому мин.лайфтайму</span></span>
<span id="cb23-47"><a href="c5_monetization.html#cb23-47" aria-hidden="true" tabindex="-1"></a>payments_new_stat <span class="ot">&lt;-</span> payments_new_stat[, <span class="fu">list</span>(<span class="at">new_payer =</span> <span class="fu">uniqueN</span>(user_pseudo_id)), </span>
<span id="cb23-48"><a href="c5_monetization.html#cb23-48" aria-hidden="true" tabindex="-1"></a>                                       by <span class="ot">=</span> <span class="fu">list</span>(media_source, lifetime)]</span>
<span id="cb23-49"><a href="c5_monetization.html#cb23-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-50"><a href="c5_monetization.html#cb23-50" aria-hidden="true" tabindex="-1"></a><span class="co"># сортируем и делаем кумулятивную сумму</span></span>
<span id="cb23-51"><a href="c5_monetization.html#cb23-51" aria-hidden="true" tabindex="-1"></a>payments_new_stat <span class="ot">&lt;-</span> payments_new_stat[<span class="fu">order</span>(media_source, lifetime)]</span>
<span id="cb23-52"><a href="c5_monetization.html#cb23-52" aria-hidden="true" tabindex="-1"></a>payments_new_stat[, new_payer_cum <span class="sc">:</span><span class="er">=</span> <span class="fu">cumsum</span>(new_payer), by <span class="ot">=</span> media_source]</span>
<span id="cb23-53"><a href="c5_monetization.html#cb23-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-54"><a href="c5_monetization.html#cb23-54" aria-hidden="true" tabindex="-1"></a><span class="co"># считаем, сколько всего пользователей пришло</span></span>
<span id="cb23-55"><a href="c5_monetization.html#cb23-55" aria-hidden="true" tabindex="-1"></a>installs_stat <span class="ot">&lt;-</span> installs[, <span class="fu">list</span>(<span class="at">total_users =</span> <span class="fu">uniqueN</span>(user_pseudo_id)), by <span class="ot">=</span> media_source]</span>
<span id="cb23-56"><a href="c5_monetization.html#cb23-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-57"><a href="c5_monetization.html#cb23-57" aria-hidden="true" tabindex="-1"></a>payments_new_stat <span class="ot">&lt;-</span> <span class="fu">merge</span>(</span>
<span id="cb23-58"><a href="c5_monetization.html#cb23-58" aria-hidden="true" tabindex="-1"></a>  payments_new_stat,</span>
<span id="cb23-59"><a href="c5_monetization.html#cb23-59" aria-hidden="true" tabindex="-1"></a>  installs_stat,</span>
<span id="cb23-60"><a href="c5_monetization.html#cb23-60" aria-hidden="true" tabindex="-1"></a>  <span class="at">by =</span> <span class="st">&#39;media_source&#39;</span>, <span class="at">all.x =</span> <span class="cn">TRUE</span></span>
<span id="cb23-61"><a href="c5_monetization.html#cb23-61" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb23-62"><a href="c5_monetization.html#cb23-62" aria-hidden="true" tabindex="-1"></a>payments_new_stat[, conversion <span class="sc">:</span><span class="er">=</span> new_payer_cum <span class="sc">/</span> total_users]</span>
<span id="cb23-63"><a href="c5_monetization.html#cb23-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-64"><a href="c5_monetization.html#cb23-64" aria-hidden="true" tabindex="-1"></a><span class="co"># рисуем</span></span>
<span id="cb23-65"><a href="c5_monetization.html#cb23-65" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_ly</span>(payments_new_stat, <span class="at">x =</span> <span class="sc">~</span>lifetime, <span class="at">y =</span> <span class="sc">~</span>conversion, <span class="at">color =</span> <span class="sc">~</span>media_source,</span>
<span id="cb23-66"><a href="c5_monetization.html#cb23-66" aria-hidden="true" tabindex="-1"></a>        <span class="at">type =</span> <span class="st">&#39;scatter&#39;</span>, <span class="at">mode =</span> <span class="st">&#39;lines&#39;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb23-67"><a href="c5_monetization.html#cb23-67" aria-hidden="true" tabindex="-1"></a>  <span class="fu">layout</span>(</span>
<span id="cb23-68"><a href="c5_monetization.html#cb23-68" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">&#39;накопительная конверсия по источникам трафика&#39;</span>,</span>
<span id="cb23-69"><a href="c5_monetization.html#cb23-69" aria-hidden="true" tabindex="-1"></a>    <span class="at">yaxis =</span> <span class="fu">list</span>(<span class="at">rangemode =</span> <span class="st">&#39;tozero&#39;</span>)</span>
<span id="cb23-70"><a href="c5_monetization.html#cb23-70" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb23-71"><a href="c5_monetization.html#cb23-71" aria-hidden="true" tabindex="-1"></a>  <span class="fu">config</span>(<span class="at">displayModeBar =</span> <span class="cn">FALSE</span>)  </span></code></pre></div>
<div class="plotly html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-67e3ecfa2ab8a225badf" style="width:672px;height:480px;"></div>
<script type="application/json" data-for="htmlwidget-67e3ecfa2ab8a225badf">{"x":{"visdat":{"3ff872c980b66":["function () ","plotlyVisDat"]},"cur_data":"3ff872c980b66","attrs":{"3ff872c980b66":{"x":{},"y":{},"mode":"lines","color":{},"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter"}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"title":"накопительная конверсия по источникам трафика","yaxis":{"domain":[0,1],"automargin":true,"rangemode":"tozero","title":"conversion"},"xaxis":{"domain":[0,1],"automargin":true,"title":"lifetime"},"hovermode":"closest","showlegend":true},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false,"displayModeBar":false},"data":[{"x":[0,1,2,3,5,7,8,9,11,13,17,27,29],"y":[0.013878180416345412,0.022359290670778721,0.024672320740169621,0.030069390902081727,0.030840400925212029,0.031611410948342328,0.033924441017733231,0.035466461063993829,0.037008481110254433,0.038550501156515038,0.039321511179645337,0.040092521202775636,0.040863531225905934],"mode":"lines","type":"scatter","name":"Facebook Ads","marker":{"color":"rgba(252,141,98,1)","line":{"color":"rgba(252,141,98,1)"}},"textfont":{"color":"rgba(252,141,98,1)"},"error_y":{"color":"rgba(252,141,98,1)"},"error_x":{"color":"rgba(252,141,98,1)"},"line":{"color":"rgba(252,141,98,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30],"y":[0.0095605410397088374,0.01510130914226737,0.018143299473083817,0.020017382801890381,0.021266771687761421,0.022787766853169647,0.023792710087457224,0.024363083274485307,0.025069259601281983,0.025721114672171221,0.02637296974306046,0.026780379162366235,0.027133467325764573,0.027377912977348037,0.027785322396653812,0.027921125536422401,0.028192731815959583,0.028328534955728176,0.028545819979357921,0.028871747514802541,0.028980390026617415,0.029170514422293445,0.029333478190015753,0.029496441957738064,0.029659405725460372,0.029903851377043836,0.029958172632951273,0.030093975772719866,0.030229778912488455,0.030256939540442174,0.030419903308164485],"mode":"lines","type":"scatter","name":"applovin_int","marker":{"color":"rgba(102,194,165,1)","line":{"color":"rgba(102,194,165,1)"}},"textfont":{"color":"rgba(102,194,165,1)"},"error_y":{"color":"rgba(102,194,165,1)"},"error_x":{"color":"rgba(102,194,165,1)"},"line":{"color":"rgba(102,194,165,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":[0,1,2,3,4,5,6,7,8,9,10,12,13,14,15,16,17,18,20,21,24,25,26,30],"y":[0.0075894005659891944,0.011062516079238487,0.012863390789812194,0.014149729868793414,0.014664265500385902,0.015307435039876511,0.015693336763570879,0.016079238487265245,0.016722408026755852,0.017494211474144584,0.018008747105737074,0.018266014921533315,0.01839464882943144,0.018651916645227681,0.018909184461023926,0.019037818368922047,0.019295086184718292,0.019423720092616413,0.019552354000514537,0.019680987908412658,0.019809621816310779,0.020066889632107024,0.020581425263699511,0.020710059171597635],"mode":"lines","type":"scatter","name":"googleadwords_int","marker":{"color":"rgba(141,160,203,1)","line":{"color":"rgba(141,160,203,1)"}},"textfont":{"color":"rgba(141,160,203,1)"},"error_y":{"color":"rgba(141,160,203,1)"},"error_x":{"color":"rgba(141,160,203,1)"},"line":{"color":"rgba(141,160,203,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30],"y":[0.0051655399549315308,0.0085630091870341485,0.010105737562835847,0.011197781244583116,0.012185820766163979,0.012619171433524007,0.012965851967412029,0.013624544981799273,0.013884555382215289,0.014196567862714509,0.014491246316519327,0.014751256716935343,0.014907262957184954,0.015149939330906569,0.015305945571156179,0.015496619864794592,0.015704628185127405,0.015860634425377017,0.016016640665626625,0.016120644825793031,0.016276651066042643,0.016415323279597851,0.016553995493153058,0.016675333680013869,0.016814005893569076,0.016900676027041081,0.016970012133818685,0.017056682267290693,0.017143352400762698,0.017282024614317906,0.017334026694401108],"mode":"lines","type":"scatter","name":"organic","marker":{"color":"rgba(231,138,195,1)","line":{"color":"rgba(231,138,195,1)"}},"textfont":{"color":"rgba(231,138,195,1)"},"error_y":{"color":"rgba(231,138,195,1)"},"error_x":{"color":"rgba(231,138,195,1)"},"line":{"color":"rgba(231,138,195,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,19,20,21,22,23,24,25,26,27,28],"y":[0.0036335558886315118,0.0060407866648498889,0.0070854339828314485,0.0078121451605577506,0.008130081300813009,0.0089930508243629918,0.0093109869646182501,0.0094926647590498243,0.0096743425534814003,0.0099468592451287634,0.010173956488168233,0.010264795385384022,0.010446473179815598,0.010582731525639278,0.010673570422855067,0.010764409320070854,0.010900667665894537,0.010991506563110324,0.011127764908934006,0.011264023254757687,0.01130944270336558,0.011445701049189263,0.01153653994640505,0.011581959395012945,0.011718217740836626,0.011763637189444519,0.011854476086660308,0.011899895535268202],"mode":"lines","type":"scatter","name":"unityads_int","marker":{"color":"rgba(166,216,84,1)","line":{"color":"rgba(166,216,84,1)"}},"textfont":{"color":"rgba(166,216,84,1)"},"error_y":{"color":"rgba(166,216,84,1)"},"error_x":{"color":"rgba(166,216,84,1)"},"line":{"color":"rgba(166,216,84,1)"},"xaxis":"x","yaxis":"y","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
<div id="level-3-hmp-4" class="section level3 hasAnchor">
<h3>level 3 (HMP)<a href="c5_monetization.html#level-3-hmp-4" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Посчитайте по каждой платформе конверсию в платящих в день инсталла. Когорта – пришедшие в июне.</p>
<p>Делать аналогично динамике ретеншена первого дня.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="c5_monetization.html#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># аналогично предыдущему заданию</span></span>
<span id="cb24-2"><a href="c5_monetization.html#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="co"># пересобираем датасет, так как в прошлом задании мы в нем делали другие вычисления</span></span>
<span id="cb24-3"><a href="c5_monetization.html#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="co"># и он нужен заново</span></span>
<span id="cb24-4"><a href="c5_monetization.html#cb24-4" aria-hidden="true" tabindex="-1"></a>payments_new <span class="ot">&lt;-</span> payments[user_pseudo_id <span class="sc">%in%</span> installs[, <span class="fu">unique</span>(user_pseudo_id)]]</span>
<span id="cb24-5"><a href="c5_monetization.html#cb24-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-6"><a href="c5_monetization.html#cb24-6" aria-hidden="true" tabindex="-1"></a>payments_new <span class="ot">&lt;-</span> <span class="fu">merge</span>(</span>
<span id="cb24-7"><a href="c5_monetization.html#cb24-7" aria-hidden="true" tabindex="-1"></a>  payments_new,</span>
<span id="cb24-8"><a href="c5_monetization.html#cb24-8" aria-hidden="true" tabindex="-1"></a>  installs[, <span class="fu">list</span>(user_pseudo_id, dt, media_source)],</span>
<span id="cb24-9"><a href="c5_monetization.html#cb24-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">by =</span> <span class="st">&#39;user_pseudo_id&#39;</span>, <span class="at">all.x =</span> <span class="cn">TRUE</span></span>
<span id="cb24-10"><a href="c5_monetization.html#cb24-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb24-11"><a href="c5_monetization.html#cb24-11" aria-hidden="true" tabindex="-1"></a>payments_new[, lifetime <span class="sc">:</span><span class="er">=</span> pay_dt <span class="sc">-</span> dt]</span>
<span id="cb24-12"><a href="c5_monetization.html#cb24-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-13"><a href="c5_monetization.html#cb24-13" aria-hidden="true" tabindex="-1"></a>payments_new <span class="ot">&lt;-</span> payments_new[dt <span class="sc">&lt;</span> <span class="st">&#39;2022-07-25&#39;</span>]</span>
<span id="cb24-14"><a href="c5_monetization.html#cb24-14" aria-hidden="true" tabindex="-1"></a>payments_new <span class="ot">&lt;-</span> payments_new[lifetime <span class="sc">&lt;=</span> <span class="dv">7</span>]</span>
<span id="cb24-15"><a href="c5_monetization.html#cb24-15" aria-hidden="true" tabindex="-1"></a>payments_new <span class="ot">&lt;-</span> payments_new[lifetime <span class="sc">&gt;=</span> <span class="dv">0</span>]</span>
<span id="cb24-16"><a href="c5_monetization.html#cb24-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-17"><a href="c5_monetization.html#cb24-17" aria-hidden="true" tabindex="-1"></a><span class="co"># отличие от предыдущего задания -- делаем группировку не по медиасорсам, а по дате инсталла</span></span>
<span id="cb24-18"><a href="c5_monetization.html#cb24-18" aria-hidden="true" tabindex="-1"></a>payments_new_stat <span class="ot">&lt;-</span> payments_new[, <span class="fu">list</span>(<span class="at">lifetime =</span> <span class="fu">min</span>(lifetime)), </span>
<span id="cb24-19"><a href="c5_monetization.html#cb24-19" aria-hidden="true" tabindex="-1"></a>                                  by <span class="ot">=</span> <span class="fu">list</span>(user_pseudo_id, dt)]</span>
<span id="cb24-20"><a href="c5_monetization.html#cb24-20" aria-hidden="true" tabindex="-1"></a>payments_new_stat <span class="ot">&lt;-</span> payments_new_stat[, <span class="fu">list</span>(<span class="at">new_payer =</span> <span class="fu">uniqueN</span>(user_pseudo_id)), </span>
<span id="cb24-21"><a href="c5_monetization.html#cb24-21" aria-hidden="true" tabindex="-1"></a>                                       by <span class="ot">=</span> <span class="fu">list</span>(dt, lifetime)]</span>
<span id="cb24-22"><a href="c5_monetization.html#cb24-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-23"><a href="c5_monetization.html#cb24-23" aria-hidden="true" tabindex="-1"></a>installs_stat <span class="ot">&lt;-</span> installs[, <span class="fu">list</span>(<span class="at">total_users =</span> <span class="fu">uniqueN</span>(user_pseudo_id)), by <span class="ot">=</span> dt]</span>
<span id="cb24-24"><a href="c5_monetization.html#cb24-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-25"><a href="c5_monetization.html#cb24-25" aria-hidden="true" tabindex="-1"></a>payments_new_stat <span class="ot">&lt;-</span> <span class="fu">merge</span>(</span>
<span id="cb24-26"><a href="c5_monetization.html#cb24-26" aria-hidden="true" tabindex="-1"></a>  payments_new_stat,</span>
<span id="cb24-27"><a href="c5_monetization.html#cb24-27" aria-hidden="true" tabindex="-1"></a>  installs_stat,</span>
<span id="cb24-28"><a href="c5_monetization.html#cb24-28" aria-hidden="true" tabindex="-1"></a>  <span class="at">by =</span> <span class="st">&#39;dt&#39;</span>, <span class="at">all.x =</span> <span class="cn">TRUE</span></span>
<span id="cb24-29"><a href="c5_monetization.html#cb24-29" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb24-30"><a href="c5_monetization.html#cb24-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-31"><a href="c5_monetization.html#cb24-31" aria-hidden="true" tabindex="-1"></a>payments_new_stat <span class="ot">&lt;-</span> payments_new_stat[<span class="fu">order</span>(dt, lifetime)]</span>
<span id="cb24-32"><a href="c5_monetization.html#cb24-32" aria-hidden="true" tabindex="-1"></a>payments_new_stat[, new_payer_cum <span class="sc">:</span><span class="er">=</span> <span class="fu">cumsum</span>(new_payer), by <span class="ot">=</span> dt]</span>
<span id="cb24-33"><a href="c5_monetization.html#cb24-33" aria-hidden="true" tabindex="-1"></a>payments_new_stat[, conversion <span class="sc">:</span><span class="er">=</span> new_payer_cum <span class="sc">/</span> total_users]</span>
<span id="cb24-34"><a href="c5_monetization.html#cb24-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-35"><a href="c5_monetization.html#cb24-35" aria-hidden="true" tabindex="-1"></a><span class="co"># оставляем только накопительную конверсию в платящих на определенные дни от инсталла</span></span>
<span id="cb24-36"><a href="c5_monetization.html#cb24-36" aria-hidden="true" tabindex="-1"></a>payments_new_stat <span class="ot">&lt;-</span> payments_new_stat[lifetime <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">7</span>)]</span>
<span id="cb24-37"><a href="c5_monetization.html#cb24-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-38"><a href="c5_monetization.html#cb24-38" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_ly</span>(payments_new_stat[dt <span class="sc">&lt;</span> <span class="st">&#39;2022-07-01&#39;</span>], </span>
<span id="cb24-39"><a href="c5_monetization.html#cb24-39" aria-hidden="true" tabindex="-1"></a>        <span class="at">x =</span> <span class="sc">~</span>dt, <span class="at">y =</span> <span class="sc">~</span>conversion, <span class="at">color =</span> <span class="sc">~</span><span class="fu">as.character</span>(lifetime),</span>
<span id="cb24-40"><a href="c5_monetization.html#cb24-40" aria-hidden="true" tabindex="-1"></a>        <span class="at">type =</span> <span class="st">&#39;scatter&#39;</span>, <span class="at">mode =</span> <span class="st">&#39;lines&#39;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb24-41"><a href="c5_monetization.html#cb24-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">layout</span>(</span>
<span id="cb24-42"><a href="c5_monetization.html#cb24-42" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">&#39;Динамика конверсии пользователей по дням&#39;</span>,</span>
<span id="cb24-43"><a href="c5_monetization.html#cb24-43" aria-hidden="true" tabindex="-1"></a>    <span class="at">yaxis =</span> <span class="fu">list</span>(<span class="at">rangemode =</span> <span class="st">&#39;tozero&#39;</span>)</span>
<span id="cb24-44"><a href="c5_monetization.html#cb24-44" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb24-45"><a href="c5_monetization.html#cb24-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">config</span>(<span class="at">displayModeBar =</span> <span class="cn">FALSE</span>)  </span></code></pre></div>
<div class="plotly html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-47ec82e3ec849626212c" style="width:672px;height:480px;"></div>
<script type="application/json" data-for="htmlwidget-47ec82e3ec849626212c">{"x":{"visdat":{"3ff8753696b8a":["function () ","plotlyVisDat"]},"cur_data":"3ff8753696b8a","attrs":{"3ff8753696b8a":{"x":{},"y":{},"mode":"lines","color":{},"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter"}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"title":"Динамика конверсии пользователей по дням","yaxis":{"domain":[0,1],"automargin":true,"rangemode":"tozero","title":"conversion"},"xaxis":{"domain":[0,1],"automargin":true,"title":"dt"},"hovermode":"closest","showlegend":true},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false,"displayModeBar":false},"data":[{"x":["2022-06-01","2022-06-02","2022-06-03","2022-06-04","2022-06-05","2022-06-06","2022-06-07","2022-06-08","2022-06-09","2022-06-10","2022-06-11","2022-06-12","2022-06-13","2022-06-14","2022-06-15","2022-06-16","2022-06-17","2022-06-18","2022-06-19","2022-06-20","2022-06-21","2022-06-22","2022-06-23","2022-06-24","2022-06-25","2022-06-26","2022-06-27","2022-06-28","2022-06-29","2022-06-30"],"y":[0.0070792418360356244,0.0093908629441624373,0.0075036075036075036,0.0075051171253127128,0.008271131732902965,0.010029633006610439,0.01038691249026227,0.0098353156450137237,0.0077948202162434,0.0069949636261891438,0.0066193853427895981,0.0089813800657174148,0.0082066135650494809,0.008634646519158122,0.0071960935492161402,0.0084459459459459464,0.0045871559633027525,0.0054024851431658562,0.0062310273206582518,0.0070169433510183128,0.0039318479685452159,0.0079392474974111157,0.010218463706835801,0.0040966816878328554,0.0075829383886255926,0.003552397868561279,0.0038204393505253103,0.0033090668431502318,0.002976190476190476,0.0096952908587257611],"mode":"lines","type":"scatter","name":"0","marker":{"color":"rgba(102,194,165,1)","line":{"color":"rgba(102,194,165,1)"}},"textfont":{"color":"rgba(102,194,165,1)"},"error_y":{"color":"rgba(102,194,165,1)"},"error_x":{"color":"rgba(102,194,165,1)"},"line":{"color":"rgba(102,194,165,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":["2022-06-01","2022-06-02","2022-06-03","2022-06-04","2022-06-05","2022-06-06","2022-06-07","2022-06-08","2022-06-09","2022-06-10","2022-06-11","2022-06-12","2022-06-13","2022-06-14","2022-06-15","2022-06-16","2022-06-17","2022-06-18","2022-06-19","2022-06-20","2022-06-21","2022-06-22","2022-06-23","2022-06-24","2022-06-25","2022-06-26","2022-06-27","2022-06-28","2022-06-29","2022-06-30"],"y":[0.012788307832838547,0.013197969543147208,0.012987012987012988,0.013873095292244713,0.014121444422029453,0.015500341919307043,0.014541677486367177,0.01555352241537054,0.012572290671360321,0.012870733072188025,0.0094562647754137114,0.014238773274917854,0.012792662321988897,0.014301133297355639,0.012593163711128244,0.015202702702702704,0.0077981651376146793,0.0075634792004321992,0.0099057357405336315,0.010610987506417936,0.0058977719528178242,0.013117017604418364,0.014094432699083862,0.0094223678820155674,0.0099526066350710905,0.0066607460035523975,0.0062082139446036294,0.0052945069490403706,0.0066964285714285711,0.012465373961218837],"mode":"lines","type":"scatter","name":"1","marker":{"color":"rgba(252,141,98,1)","line":{"color":"rgba(252,141,98,1)"}},"textfont":{"color":"rgba(252,141,98,1)"},"error_y":{"color":"rgba(252,141,98,1)"},"error_x":{"color":"rgba(252,141,98,1)"},"line":{"color":"rgba(252,141,98,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":["2022-06-01","2022-06-02","2022-06-03","2022-06-04","2022-06-05","2022-06-06","2022-06-07","2022-06-08","2022-06-09","2022-06-10","2022-06-11","2022-06-12","2022-06-13","2022-06-14","2022-06-15","2022-06-16","2022-06-17","2022-06-18","2022-06-19","2022-06-20","2022-06-21","2022-06-22","2022-06-23","2022-06-24","2022-06-25","2022-06-26","2022-06-27","2022-06-28"],"y":[0.01644211007079242,0.017766497461928935,0.01875901875901876,0.020468501250852856,0.016743998386120638,0.021198997036699339,0.019475460919241756,0.020814272644098811,0.015841086245914005,0.018186905428091774,0.015130023640661938,0.017524644030668127,0.017137340091720975,0.018618456556934702,0.016448213826779749,0.018339768339768341,0.009862385321100918,0.0093643075814874837,0.012302284710017574,0.013520451822693822,0.0085190039318479693,0.01794960303762513,0.015856236786469344,0.012699713232281851,0.011374407582938388,0.010657193605683837,0.0085959885386819486,0.0066181336863004635],"mode":"lines","type":"scatter","name":"3","marker":{"color":"rgba(141,160,203,1)","line":{"color":"rgba(141,160,203,1)"}},"textfont":{"color":"rgba(141,160,203,1)"},"error_y":{"color":"rgba(141,160,203,1)"},"error_x":{"color":"rgba(141,160,203,1)"},"line":{"color":"rgba(141,160,203,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":["2022-06-01","2022-06-02","2022-06-03","2022-06-04","2022-06-05","2022-06-06","2022-06-07","2022-06-08","2022-06-09","2022-06-10","2022-06-11","2022-06-12","2022-06-13","2022-06-14","2022-06-15","2022-06-16","2022-06-17","2022-06-18","2022-06-19","2022-06-20","2022-06-21","2022-06-22","2022-06-23","2022-06-24","2022-06-25","2022-06-26","2022-06-29","2022-06-30"],"y":[0.01918246174925782,0.021065989847715735,0.021356421356421358,0.025699340459404141,0.022190841234617713,0.024618190107134716,0.023110880290833549,0.02584629460201281,0.02036711088760372,0.020145495243424735,0.017730496453900711,0.021905805038335158,0.020033791938209027,0.02239611440906638,0.019275250578257519,0.022924710424710424,0.012155963302752294,0.010985053124437242,0.014539063748202588,0.01574533629984597,0.011795543905635648,0.02105626510182948,0.017618040873854827,0.015157722244981565,0.014218009478672985,0.013321492007104795,0.0096726190476190479,0.013850415512465374],"mode":"lines","type":"scatter","name":"7","marker":{"color":"rgba(231,138,195,1)","line":{"color":"rgba(231,138,195,1)"}},"textfont":{"color":"rgba(231,138,195,1)"},"error_y":{"color":"rgba(231,138,195,1)"},"error_x":{"color":"rgba(231,138,195,1)"},"line":{"color":"rgba(231,138,195,1)"},"xaxis":"x","yaxis":"y","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<div id="воронка-платежей" class="section level2 hasAnchor">
<h2>Воронка платежей<a href="c5_monetization.html#воронка-платежей" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Доля пользователей, которые сделали второй, третий и т.д. платеж.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="c5_monetization.html#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># опять пересобираем исходную табличку платежей</span></span>
<span id="cb25-2"><a href="c5_monetization.html#cb25-2" aria-hidden="true" tabindex="-1"></a>payments_new <span class="ot">&lt;-</span> payments[user_pseudo_id <span class="sc">%in%</span> installs[, <span class="fu">unique</span>(user_pseudo_id)]]</span>
<span id="cb25-3"><a href="c5_monetization.html#cb25-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-4"><a href="c5_monetization.html#cb25-4" aria-hidden="true" tabindex="-1"></a>payments_new <span class="ot">&lt;-</span> <span class="fu">merge</span>(</span>
<span id="cb25-5"><a href="c5_monetization.html#cb25-5" aria-hidden="true" tabindex="-1"></a>  payments_new,</span>
<span id="cb25-6"><a href="c5_monetization.html#cb25-6" aria-hidden="true" tabindex="-1"></a>  installs[, <span class="fu">list</span>(user_pseudo_id, dt, media_source)],</span>
<span id="cb25-7"><a href="c5_monetization.html#cb25-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">by =</span> <span class="st">&#39;user_pseudo_id&#39;</span>, <span class="at">all.x =</span> <span class="cn">TRUE</span></span>
<span id="cb25-8"><a href="c5_monetization.html#cb25-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb25-9"><a href="c5_monetization.html#cb25-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-10"><a href="c5_monetization.html#cb25-10" aria-hidden="true" tabindex="-1"></a><span class="co"># отсортировать платежи пользователей по возрастанию </span></span>
<span id="cb25-11"><a href="c5_monetization.html#cb25-11" aria-hidden="true" tabindex="-1"></a>payments_new <span class="ot">&lt;-</span> payments_new[<span class="fu">order</span>(user_pseudo_id, ts)]</span>
<span id="cb25-12"><a href="c5_monetization.html#cb25-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-13"><a href="c5_monetization.html#cb25-13" aria-hidden="true" tabindex="-1"></a><span class="co"># альтернативные методы сортировки</span></span>
<span id="cb25-14"><a href="c5_monetization.html#cb25-14" aria-hidden="true" tabindex="-1"></a><span class="co"># setkey(payments_new, user_pseudo_id, ts)</span></span>
<span id="cb25-15"><a href="c5_monetization.html#cb25-15" aria-hidden="true" tabindex="-1"></a><span class="co"># setorder(payments_new, user_pseudo_id, ts)</span></span>
<span id="cb25-16"><a href="c5_monetization.html#cb25-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-17"><a href="c5_monetization.html#cb25-17" aria-hidden="true" tabindex="-1"></a><span class="co"># создаем номер платежа каждого пользователя. 1:.N -- и так в группе по пользователям</span></span>
<span id="cb25-18"><a href="c5_monetization.html#cb25-18" aria-hidden="true" tabindex="-1"></a>payments_new[, purchase_number <span class="sc">:</span><span class="er">=</span> <span class="dv">1</span><span class="sc">:</span>.N, by <span class="ot">=</span> user_pseudo_id]</span>
<span id="cb25-19"><a href="c5_monetization.html#cb25-19" aria-hidden="true" tabindex="-1"></a><span class="co"># payments_new[, purchase_number := seq(1, .N, by = 1), by = user_pseudo_id]</span></span>
<span id="cb25-20"><a href="c5_monetization.html#cb25-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-21"><a href="c5_monetization.html#cb25-21" aria-hidden="true" tabindex="-1"></a>payments_new[, lifetime <span class="sc">:</span><span class="er">=</span> pay_dt <span class="sc">-</span> dt]</span>
<span id="cb25-22"><a href="c5_monetization.html#cb25-22" aria-hidden="true" tabindex="-1"></a>payments_new <span class="ot">&lt;-</span> payments_new[dt <span class="sc">&lt;</span> <span class="st">&#39;2022-07-01&#39;</span>]</span>
<span id="cb25-23"><a href="c5_monetization.html#cb25-23" aria-hidden="true" tabindex="-1"></a>payments_new <span class="ot">&lt;-</span> payments_new[lifetime <span class="sc">&lt;=</span> <span class="dv">30</span>]</span>
<span id="cb25-24"><a href="c5_monetization.html#cb25-24" aria-hidden="true" tabindex="-1"></a>payments_new <span class="ot">&lt;-</span> payments_new[lifetime <span class="sc">&gt;=</span> <span class="dv">0</span>]</span>
<span id="cb25-25"><a href="c5_monetization.html#cb25-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-26"><a href="c5_monetization.html#cb25-26" aria-hidden="true" tabindex="-1"></a><span class="co"># считаем, сколько пользователей сделало платеж с этим номером</span></span>
<span id="cb25-27"><a href="c5_monetization.html#cb25-27" aria-hidden="true" tabindex="-1"></a>payments_funnel <span class="ot">&lt;-</span> payments_new[, <span class="fu">list</span>(<span class="at">n_users =</span> <span class="fu">uniqueN</span>(user_pseudo_id)), keyby <span class="ot">=</span> purchase_number]</span>
<span id="cb25-28"><a href="c5_monetization.html#cb25-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-29"><a href="c5_monetization.html#cb25-29" aria-hidden="true" tabindex="-1"></a><span class="co"># считаем посчитать долю от всего пользователей, сделавших платеж (purchase_number == 1)</span></span>
<span id="cb25-30"><a href="c5_monetization.html#cb25-30" aria-hidden="true" tabindex="-1"></a>payments_funnel[, total_payers <span class="sc">:</span><span class="er">=</span> n_users[purchase_number <span class="sc">==</span> <span class="dv">1</span>]]</span>
<span id="cb25-31"><a href="c5_monetization.html#cb25-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-32"><a href="c5_monetization.html#cb25-32" aria-hidden="true" tabindex="-1"></a><span class="co"># если у нас есть группировка, то надо отдельно считать и мерджить по ключу</span></span>
<span id="cb25-33"><a href="c5_monetization.html#cb25-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-34"><a href="c5_monetization.html#cb25-34" aria-hidden="true" tabindex="-1"></a><span class="co"># рисуем</span></span>
<span id="cb25-35"><a href="c5_monetization.html#cb25-35" aria-hidden="true" tabindex="-1"></a>payments_funnel[, share <span class="sc">:</span><span class="er">=</span> n_users <span class="sc">/</span> total_payers]</span>
<span id="cb25-36"><a href="c5_monetization.html#cb25-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-37"><a href="c5_monetization.html#cb25-37" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_ly</span>(payments_funnel[purchase_number <span class="sc">&lt;=</span> <span class="dv">10</span>], </span>
<span id="cb25-38"><a href="c5_monetization.html#cb25-38" aria-hidden="true" tabindex="-1"></a>        <span class="at">x =</span> <span class="sc">~</span>purchase_number, <span class="at">y =</span> <span class="sc">~</span>share, <span class="at">type =</span> <span class="st">&#39;bar&#39;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb25-39"><a href="c5_monetization.html#cb25-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">layout</span>(</span>
<span id="cb25-40"><a href="c5_monetization.html#cb25-40" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">&#39;Воронка платежей&#39;</span></span>
<span id="cb25-41"><a href="c5_monetization.html#cb25-41" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb25-42"><a href="c5_monetization.html#cb25-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">config</span>(<span class="at">displayModeBar =</span> <span class="cn">FALSE</span>)  </span></code></pre></div>
<div class="plotly html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-f79c0e643003e8157407" style="width:672px;height:480px;"></div>
<script type="application/json" data-for="htmlwidget-f79c0e643003e8157407">{"x":{"visdat":{"3ff876dde19db":["function () ","plotlyVisDat"]},"cur_data":"3ff876dde19db","attrs":{"3ff876dde19db":{"x":{},"y":{},"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"bar"}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"title":"Воронка платежей","xaxis":{"domain":[0,1],"automargin":true,"title":"purchase_number"},"yaxis":{"domain":[0,1],"automargin":true,"title":"share"},"hovermode":"closest","showlegend":false},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false,"displayModeBar":false},"data":[{"x":[1,2,3,4,5,6,7,8,9,10],"y":[1,0.53423597678916823,0.36092843326885882,0.26847195357833653,0.20851063829787234,0.17485493230174082,0.14313346228239845,0.12340425531914893,0.10522243713733076,0.095164410058027074],"type":"bar","marker":{"color":"rgba(31,119,180,1)","line":{"color":"rgba(31,119,180,1)"}},"error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"xaxis":"x","yaxis":"y","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
<p>Воронки можно считать не от первого шага, а от предыдущего. В некоторых случаях это удобнее и информативнее.</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="c5_monetization.html#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># если хотим считать от предыдущего шага</span></span>
<span id="cb26-2"><a href="c5_monetization.html#cb26-2" aria-hidden="true" tabindex="-1"></a>payments_funnel[, prev_users <span class="sc">:</span><span class="er">=</span> <span class="fu">shift</span>(n_users, <span class="at">n =</span> <span class="dv">1</span>)]</span>
<span id="cb26-3"><a href="c5_monetization.html#cb26-3" aria-hidden="true" tabindex="-1"></a>payments_funnel[, prev_share <span class="sc">:</span><span class="er">=</span> n_users <span class="sc">/</span> prev_users]</span>
<span id="cb26-4"><a href="c5_monetization.html#cb26-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-5"><a href="c5_monetization.html#cb26-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_ly</span>(payments_funnel[purchase_number <span class="sc">&lt;=</span> <span class="dv">10</span>], </span>
<span id="cb26-6"><a href="c5_monetization.html#cb26-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">x =</span> <span class="sc">~</span>purchase_number, <span class="at">y =</span> <span class="sc">~</span>prev_share, <span class="at">type =</span> <span class="st">&#39;bar&#39;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb26-7"><a href="c5_monetization.html#cb26-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">layout</span>(</span>
<span id="cb26-8"><a href="c5_monetization.html#cb26-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">&#39;Воронка платежей, доля от предыдущего&#39;</span></span>
<span id="cb26-9"><a href="c5_monetization.html#cb26-9" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb26-10"><a href="c5_monetization.html#cb26-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">config</span>(<span class="at">displayModeBar =</span> <span class="cn">FALSE</span>)  </span></code></pre></div>
<pre><code>## Warning: Ignoring 1 observations</code></pre>
<div class="plotly html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-01587c693b730a04786b" style="width:672px;height:480px;"></div>
<script type="application/json" data-for="htmlwidget-01587c693b730a04786b">{"x":{"visdat":{"3ff875cc6ef9a":["function () ","plotlyVisDat"]},"cur_data":"3ff875cc6ef9a","attrs":{"3ff875cc6ef9a":{"x":{},"y":{},"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"bar"}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"title":"Воронка платежей, доля от предыдущего","xaxis":{"domain":[0,1],"automargin":true,"title":"purchase_number"},"yaxis":{"domain":[0,1],"automargin":true,"title":"prev_share"},"hovermode":"closest","showlegend":false},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false,"displayModeBar":false},"data":[{"x":[2,3,4,5,6,7,8,9,10],"y":[0.53423597678916823,0.67559739319333811,0.7438370846730975,0.77665706051873196,0.83858998144712427,0.81858407079646023,0.86216216216216213,0.85266457680250785,0.90441176470588236],"type":"bar","marker":{"color":"rgba(31,119,180,1)","line":{"color":"rgba(31,119,180,1)"}},"error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"xaxis":"x","yaxis":"y","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="c5_monetization.html#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_ly</span>(payments_funnel[purchase_number <span class="sc">&lt;=</span> <span class="dv">10</span>], </span>
<span id="cb28-2"><a href="c5_monetization.html#cb28-2" aria-hidden="true" tabindex="-1"></a>        <span class="at">x =</span> <span class="sc">~</span>purchase_number, <span class="at">y =</span> <span class="sc">~</span>share, <span class="at">type =</span> <span class="st">&#39;bar&#39;</span>, <span class="at">name =</span> <span class="st">&#39;% from payers&#39;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb28-3"><a href="c5_monetization.html#cb28-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_trace</span>(<span class="at">y =</span> <span class="sc">~</span>prev_share, <span class="at">name =</span> <span class="st">&#39;% from prev&#39;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb28-4"><a href="c5_monetization.html#cb28-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">layout</span>(</span>
<span id="cb28-5"><a href="c5_monetization.html#cb28-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">&#39;Воронка платежей&#39;</span></span>
<span id="cb28-6"><a href="c5_monetization.html#cb28-6" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb28-7"><a href="c5_monetization.html#cb28-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">config</span>(<span class="at">displayModeBar =</span> <span class="cn">FALSE</span>)  </span></code></pre></div>
<pre><code>## Warning: Ignoring 1 observations</code></pre>
<div class="plotly html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-b10506cf26caac00f683" style="width:672px;height:480px;"></div>
<script type="application/json" data-for="htmlwidget-b10506cf26caac00f683">{"x":{"visdat":{"3ff874e2f72a4":["function () ","plotlyVisDat"]},"cur_data":"3ff874e2f72a4","attrs":{"3ff874e2f72a4":{"x":{},"y":{},"name":"% from payers","alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"bar"},"3ff874e2f72a4.1":{"x":{},"y":{},"name":"% from prev","alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"bar","inherit":true}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"title":"Воронка платежей","xaxis":{"domain":[0,1],"automargin":true,"title":"purchase_number"},"yaxis":{"domain":[0,1],"automargin":true,"title":"share"},"hovermode":"closest","showlegend":true},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false,"displayModeBar":false},"data":[{"x":[1,2,3,4,5,6,7,8,9,10],"y":[1,0.53423597678916823,0.36092843326885882,0.26847195357833653,0.20851063829787234,0.17485493230174082,0.14313346228239845,0.12340425531914893,0.10522243713733076,0.095164410058027074],"name":"% from payers","type":"bar","marker":{"color":"rgba(31,119,180,1)","line":{"color":"rgba(31,119,180,1)"}},"error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":[2,3,4,5,6,7,8,9,10],"y":[0.53423597678916823,0.67559739319333811,0.7438370846730975,0.77665706051873196,0.83858998144712427,0.81858407079646023,0.86216216216216213,0.85266457680250785,0.90441176470588236],"name":"% from prev","type":"bar","marker":{"color":"rgba(255,127,14,1)","line":{"color":"rgba(255,127,14,1)"}},"error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"xaxis":"x","yaxis":"y","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="c4_monetization.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="метрики-монетизации-pt.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": false,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "section",
"scroll_highlight": true
},
"toolbar": {
"position": "static"
}
});
});
</script>

</body>

</html>
